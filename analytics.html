<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - da Realest Geek</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/modern-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-links a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #764ba2;
        }

        .page-title {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .page-title h1 {
            font-size: 32px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .page-title p {
            color: #666;
            font-size: 18px;
        }

        .analytics-controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .date-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-range input,
        .date-range select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn.secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e9ecef;
        }

        .btn.secondary:hover {
            background: #e9ecef;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .kpi-icon {
            font-size: 32px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .kpi-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .kpi-change {
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .kpi-change.positive {
            background: #d4edda;
            color: #155724;
        }

        .kpi-change.negative {
            background: #f8d7da;
            color: #721c24;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .chart-canvas {
            max-height: 400px;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .performance-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .performance-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            color: #333;
        }

        .metric-value {
            font-weight: bold;
            color: #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .leaderboard h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .rank {
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .rank.gold {
            background: #FFD700;
            color: #333;
        }

        .rank.silver {
            background: #C0C0C0;
            color: #333;
        }

        .rank.bronze {
            background: #CD7F32;
            color: white;
        }

        .agent-info {
            flex: 1;
        }

        .agent-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .agent-stats {
            font-size: 12px;
            color: #666;
        }

        .agent-score {
            font-weight: bold;
            color: #667eea;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #4CAF50; }
        .notification.error { background: #f44336; }
        .notification.info { background: #2196F3; }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .analytics-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .date-range {
                flex-direction: column;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <i class="fas fa-chart-line"></i> Analytics Dashboard
            </div>
            <nav class="nav-links">
                <a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
                <a href="email-campaigns.html"><i class="fas fa-envelope"></i> Campaigns</a>
                <a href="lead-generation.html"><i class="fas fa-users"></i> Leads</a>
                <a href="appointments.html"><i class="fas fa-calendar"></i> Calendar</a>
                <button class="btn secondary" onclick="logout()" style="width: auto; margin: 0; padding: 8px 16px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </nav>
        </header>

        <section class="page-title">
            <h1>Analytics & Reporting</h1>
            <p>Track your performance and gain insights into your real estate business</p>
        </section>

        <div class="analytics-controls">
            <div class="date-range">
                <label>Date Range:</label>
                <input type="date" id="startDate" value="2024-01-01">
                <span>to</span>
                <input type="date" id="endDate" value="2024-01-31">
                <select id="periodSelect" onchange="updatePeriod()">
                    <option value="custom">Custom Range</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month" selected>This Month</option>
                    <option value="quarter">This Quarter</option>
                    <option value="year">This Year</option>
                </select>
            </div>
            <div>
                <button class="btn" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
                <button class="btn secondary" onclick="exportReport()">
                    <i class="fas fa-download"></i> Export Report
                </button>
            </div>
        </div>

        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-icon"><i class="fas fa-dollar-sign"></i></div>
                <div class="kpi-value" id="totalRevenue">$847,250</div>
                <div class="kpi-label">Total Revenue</div>
                <div class="kpi-change positive">+12.5% from last month</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon"><i class="fas fa-handshake"></i></div>
                <div class="kpi-value" id="totalDeals">23</div>
                <div class="kpi-label">Closed Deals</div>
                <div class="kpi-change positive">+8.3% from last month</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon"><i class="fas fa-users"></i></div>
                <div class="kpi-value" id="totalLeads">247</div>
                <div class="kpi-label">Total Leads</div>
                <div class="kpi-change positive">+15.2% from last month</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon"><i class="fas fa-percentage"></i></div>
                <div class="kpi-value" id="conversionRate">9.3%</div>
                <div class="kpi-label">Conversion Rate</div>
                <div class="kpi-change negative">-2.1% from last month</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon"><i class="fas fa-clock"></i></div>
                <div class="kpi-value" id="avgResponseTime">2.3h</div>
                <div class="kpi-label">Avg Response Time</div>
                <div class="kpi-change positive">-0.5h from last month</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon"><i class="fas fa-star"></i></div>
                <div class="kpi-value" id="customerSatisfaction">4.8</div>
                <div class="kpi-label">Customer Rating</div>
                <div class="kpi-change positive">+0.2 from last month</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Revenue Trend</div>
                    <select id="revenueChartType" onchange="updateRevenueChart()">
                        <option value="monthly">Monthly</option>
                        <option value="weekly">Weekly</option>
                        <option value="daily">Daily</option>
                    </select>
                </div>
                <canvas id="revenueChart" class="chart-canvas"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Lead Sources</div>
                </div>
                <canvas id="leadSourceChart" class="chart-canvas"></canvas>
            </div>
        </div>

        <div class="performance-grid">
            <div class="performance-card">
                <h3>Sales Performance</h3>
                <div class="metric-item">
                    <span class="metric-label">Properties Sold</span>
                    <span class="metric-value">23</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Average Sale Price</span>
                    <span class="metric-value">$368,260</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Commission Earned</span>
                    <span class="metric-value">$25,378</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Days on Market (Avg)</span>
                    <span class="metric-value">28 days</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Goal Progress</span>
                    <span class="metric-value">76%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 76%"></div>
                </div>
            </div>

            <div class="performance-card">
                <h3>Marketing Performance</h3>
                <div class="metric-item">
                    <span class="metric-label">Email Open Rate</span>
                    <span class="metric-value">24.5%</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Click-through Rate</span>
                    <span class="metric-value">3.8%</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Social Media Reach</span>
                    <span class="metric-value">12,450</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Website Visitors</span>
                    <span class="metric-value">8,923</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Lead Quality Score</span>
                    <span class="metric-value">8.2/10</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 82%"></div>
                </div>
            </div>

            <div class="performance-card">
                <h3>Client Satisfaction</h3>
                <div class="metric-item">
                    <span class="metric-label">Overall Rating</span>
                    <span class="metric-value">4.8/5</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Response Time</span>
                    <span class="metric-value">2.3 hours</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Repeat Clients</span>
                    <span class="metric-value">18%</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Referral Rate</span>
                    <span class="metric-value">32%</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Client Retention</span>
                    <span class="metric-value">94%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 94%"></div>
                </div>
            </div>
        </div>

        <div class="leaderboard">
            <h3>Top Performing Agents</h3>
            <div class="leaderboard-item">
                <div class="rank gold">1</div>
                <div class="agent-info">
                    <div class="agent-name">Sarah Johnson</div>
                    <div class="agent-stats">15 deals closed • $1.2M revenue</div>
                </div>
                <div class="agent-score">$1,247,500</div>
            </div>
            <div class="leaderboard-item">
                <div class="rank silver">2</div>
                <div class="agent-info">
                    <div class="agent-name">Mike Davis</div>
                    <div class="agent-stats">12 deals closed • $980K revenue</div>
                </div>
                <div class="agent-score">$987,250</div>
            </div>
            <div class="leaderboard-item">
                <div class="rank bronze">3</div>
                <div class="agent-info">
                    <div class="agent-name">Emily Wilson</div>
                    <div class="agent-stats">10 deals closed • $750K revenue</div>
                </div>
                <div class="agent-score">$756,800</div>
            </div>
            <div class="leaderboard-item">
                <div class="rank">4</div>
                <div class="agent-info">
                    <div class="agent-name">John Smith</div>
                    <div class="agent-stats">8 deals closed • $620K revenue</div>
                </div>
                <div class="agent-score">$623,400</div>
            </div>
            <div class="leaderboard-item">
                <div class="rank">5</div>
                <div class="agent-info">
                    <div class="agent-name">Robert Brown</div>
                    <div class="agent-stats">6 deals closed • $480K revenue</div>
                </div>
                <div class="agent-score">$485,200</div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script src="security-enhancements.js"></script>
    <script>
        // Initialize security
        const security = new SecurityEnhancer();
        
        let revenueChart, leadSourceChart;

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            initializeCharts();
            updatePeriod();
        });

        function checkAuthentication() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (!isLoggedIn || isLoggedIn !== 'true') {
                showNotification('Please log in to access analytics', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }
        }

        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Revenue',
                        data: [65000, 72000, 68000, 85000, 92000, 78000, 95000, 88000, 102000, 96000, 110000, 125000],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000) + 'K';
                                }
                            }
                        }
                    }
                }
            });

            // Lead Source Chart
            const leadSourceCtx = document.getElementById('leadSourceChart').getContext('2d');
            leadSourceChart = new Chart(leadSourceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Website', 'Social Media', 'Referrals', 'Open Houses', 'Cold Calls'],
                    datasets: [{
                        data: [89, 67, 45, 32, 14],
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#4CAF50',
                            '#FF9800',
                            '#f44336'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updatePeriod() {
            const period = document.getElementById('periodSelect').value;
            const today = new Date();
            let startDate, endDate;

            switch (period) {
                case 'today':
                    startDate = endDate = today.toISOString().split('T')[0];
                    break;
                case 'week':
                    const startOfWeek = new Date(today);
                    startOfWeek.setDate(today.getDate() - today.getDay());
                    const endOfWeek = new Date(startOfWeek);
                    endOfWeek.setDate(startOfWeek.getDate() + 6);
                    startDate = startOfWeek.toISOString().split('T')[0];
                    endDate = endOfWeek.toISOString().split('T')[0];
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0).toISOString().split('T')[0];
                    break;
                case 'quarter':
                    const quarter = Math.floor(today.getMonth() / 3);
                    startDate = new Date(today.getFullYear(), quarter * 3, 1).toISOString().split('T')[0];
                    endDate = new Date(today.getFullYear(), quarter * 3 + 3, 0).toISOString().split('T')[0];
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1).toISOString().split('T')[0];
                    endDate = new Date(today.getFullYear(), 11, 31).toISOString().split('T')[0];
                    break;
                default:
                    return; // Custom range, don't update
            }

            document.getElementById('startDate').value = startDate;
            document.getElementById('endDate').value = endDate;
            refreshData();
        }

        function updateRevenueChart() {
            const chartType = document.getElementById('revenueChartType').value;
            let labels, data;

            switch (chartType) {
                case 'daily':
                    labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    data = [12000, 15000, 8000, 22000, 18000, 25000, 20000];
                    break;
                case 'weekly':
                    labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    data = [85000, 92000, 78000, 95000];
                    break;
                default: // monthly
                    labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    data = [65000, 72000, 68000, 85000, 92000, 78000, 95000, 88000, 102000, 96000, 110000, 125000];
            }

            revenueChart.data.labels = labels;
            revenueChart.data.datasets[0].data = data;
            revenueChart.update();
        }

        function refreshData() {
            showNotification('Refreshing analytics data...', 'info');
            
            // Simulate data refresh with random variations
            setTimeout(() => {
                updateKPIs();
                updateCharts();
                showNotification('Data refreshed successfully!', 'success');
            }, 2000);
        }

        function updateKPIs() {
            // Simulate real-time KPI updates with slight variations
            const baseRevenue = 847250;
            const variation = (Math.random() - 0.5) * 0.1; // ±5% variation
            const newRevenue = Math.floor(baseRevenue * (1 + variation));
            
            document.getElementById('totalRevenue').textContent = '$' + newRevenue.toLocaleString();
            document.getElementById('totalDeals').textContent = Math.floor(23 + (Math.random() - 0.5) * 4);
            document.getElementById('totalLeads').textContent = Math.floor(247 + (Math.random() - 0.5) * 20);
            document.getElementById('conversionRate').textContent = (9.3 + (Math.random() - 0.5) * 2).toFixed(1) + '%';
            document.getElementById('avgResponseTime').textContent = (2.3 + (Math.random() - 0.5) * 0.8).toFixed(1) + 'h';
            document.getElementById('customerSatisfaction').textContent = (4.8 + (Math.random() - 0.5) * 0.4).toFixed(1);
        }

        function updateCharts() {
            // Update revenue chart with new data
            const newData = revenueChart.data.datasets[0].data.map(value => {
                const variation = (Math.random() - 0.5) * 0.2; // ±10% variation
                return Math.floor(value * (1 + variation));
            });
            
            revenueChart.data.datasets[0].data = newData;
            revenueChart.update();

            // Update lead source chart with new data
            const newLeadData = leadSourceChart.data.datasets[0].data.map(value => {
                const variation = (Math.random() - 0.5) * 0.3; // ±15% variation
                return Math.max(1, Math.floor(value * (1 + variation)));
            });
            
            leadSourceChart.data.datasets[0].data = newLeadData;
            leadSourceChart.update();
        }

        function exportReport() {
            showNotification('Generating analytics report...', 'info');
            
            // Simulate report generation
            setTimeout(() => {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                // Create a simple CSV-like report
                const reportData = [
                    'Real Estate Analytics Report',
                    `Period: ${startDate} to ${endDate}`,
                    '',
                    'Key Performance Indicators:',
                    `Total Revenue: ${document.getElementById('totalRevenue').textContent}`,
                    `Closed Deals: ${document.getElementById('totalDeals').textContent}`,
                    `Total Leads: ${document.getElementById('totalLeads').textContent}`,
                    `Conversion Rate: ${document.getElementById('conversionRate').textContent}`,
                    `Avg Response Time: ${document.getElementById('avgResponseTime').textContent}`,
                    `Customer Satisfaction: ${document.getElementById('customerSatisfaction').textContent}`,
                    '',
                    'Lead Sources:',
                    'Website: 89 leads',
                    'Social Media: 67 leads',
                    'Referrals: 45 leads',
                    'Open Houses: 32 leads',
                    'Cold Calls: 14 leads'
                ];
                
                const blob = new Blob([reportData.join('\n')], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `analytics-report-${startDate}-to-${endDate}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showNotification('Report exported successfully!', 'success');
            }, 2000);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                showNotification('Logged out successfully', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = security.sanitizeInput(message);
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Auto-refresh data every 5 minutes
        setInterval(() => {
            updateKPIs();
        }, 300000);

        // Update charts when window is resized
        window.addEventListener('resize', () => {
            if (revenueChart) revenueChart.resize();
            if (leadSourceChart) leadSourceChart.resize();
        });
    </script>
</body>
</html>